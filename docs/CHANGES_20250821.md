---
project: shorts-player-kit
log_id: CHANGES_20250821
title: "Textastic安全域の実装確立と反省の制度化"
updated_jst: "2025-08-21T19:30:00+09:00"
scope: [runtime, debug_panel, tts, shortcuts, docs]
devices: ["iPhone16ProMax", "Safari", "Textastic"]
safe_area_offset_px: 80
external_assist: true
ack_notes: "safe-area(env)＋visualViewport＋viewport-fit=cover の組合せへ外部助言で到達。実測+80pxで安定化。"
breaking_changes: false
known_issues:
  - "Safariでは下端が僅かに上がる場合あり（許容範囲）"
repentance:
  - "R1: エディタWebViewとSafari実機を即切り分け"
  - "R2: 30分停滞で外部知見探索を発動"
  - "R3: 最小HTMLでenv/visualViewport/transform単独検証→本体反映"
  - "R4: 調査は2時間上限→分岐か撤退"
  - "R5: 指示はブロック置換優先＋3Step＋直前/直後行を完全体で"
  - "R6: 外部助言・実測値(+80px)・不採用案を必ず記録"
  - "R7: 実験改変は別フォルダ、本線は最小差分"
next_steps:
  - "docs/CHANGES.min.mdへ本日の要点を追記（箇条書き運用へ移行）"
  - "handshake.jsonにknown_pitfallsへ+80px条件を追記"
---

# CHANGES — shorts-player-kit（CHANGES_20250821.md）
**最終更新（手動）:** 2025-08-21 19:30 JST  
**対象範囲:** ランタイム（HTML/CSS/JS）、デバッグパネル、TTS、ショートカット連携、運用ドキュメント

本ファイルは「その日に何が・なぜ・どう変わったか」の **実装版ログ** です。  
レビュー/配布向けの短縮版は `docs/CHANGES.min.md` を参照。

## 2025-08-21 — Textastic 安全域の実装確立と反省の制度化

### 概要（What / Why）
- **What:** `env(safe-area-inset-*)` + `visualViewport` + 実測オフセット（+80px）でTextastic下端固定を解消。  
  DPに **Note読み（既定OFF）** と **m4a Export（現在/全体）** を実装。  
- **Why:** 実機で8時間以上停滞。外部助言により突破した事実を明記し制度化。

### 技術的変更点（Changed / Added / Fixed / Removed）
- **Changed:** `index.html`へsafe-area直書き、`touch-action: manipulation`、`debug_panel.js`のES5/追従更新  
- **Added:** `readNote`、Exportボタン、`collect*Text`/`runShortcutForText`  
- **Fixed:** 中段固定の解消、左右切れ修正、Note無音を`speakScene()`で解消  
- **Removed/Deprecated:** Bias可視UI、非露出声列挙UI（Siri/Hattoriなど）

### Root Cause（推定）
- Textastic内蔵WebViewの安全域/再描画取り扱い差によりCSS適用境界が中段で途切れる挙動。

### 外部助力の明記（Acknowledgement）
- 外部AI助言でsafe-area活用へ短時間到達。それを`visualViewport`・+80px実測で補強。

### “悔い改め（Repentance）”—運用プロトコル
- R1–R7（上記Front Matter参照）

### 検証（Verify）
- A/B/Tベール、Note読み、m4a保存（現在/全体）成功。Safariの軽微ズレは許容。

### 既知の注意点
- Shortcutsは前面遷移（録画と両立不可）。MP3はa-Shell+LAMEの実験路線。

### 次の一手（NS-Core+J）
- Propose: min版へ追記・handshake更新  
- Justify: 透明性と再発防止  
- Min-Execute: 文書差分のみ  
- Verify: `Updated:`/末尾追記の確認  
- Record: 反映を`docs/CHANGES.min.md`・`handshake.json`に記録